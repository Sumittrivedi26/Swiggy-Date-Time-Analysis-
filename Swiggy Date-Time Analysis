SELECT
  *
FROM
  SWIGGY
LIMIT
  10;

  
SELECT COUNT(*) FROM SWIGGY;  ---COUNTING THE NUMBER OF ROWS 



SELECT COUNT(*) FROM SWIGGY GROUP BY ORDER_ID HAVING COUNT(*) > 1; --- CHECKING FOR DUPLICATES



SELECT ORDER_DATE , DELIVERY_TIME FROM SWIGGY; -- CHECKING THE DATE COLUMNS FOR CHANGING DATATYPE



SHOW PARAMETERS LIKE 'TIMEZONE'; --IDENTIFYING THE TIMEZONE WE ARE ON

ALTER SESSION  SET TIMEZONE = 'Asia/Kolkata'; ---CONVERTINGH THE TIMEZON


SHOW PARAMETERS LIKE 'TIMEZONE';



---CREATEING A NEW COLUMN & CONVERTING THE DATATYPE TO TIMESTAMP FOR BOTH DATE COLUMNS





ALTER TABLE SWIGGY
ADD COLUMN  ORDER_DATE_FORMAT TIMESTAMP;


UPDATE SWIGGY
SET ORDER_DATE_FORMAT = TO_TIMESTAMP(ORDER_DATE, 'DD/MM/YY HH24:MI');



ALTER TABLE SWIGGY
ADD COLUMN DELIVERY_TIME_FORMATED TIMESTAMP;


UPDATE SWIGGY
SET DELIVERY_TIME_FORMATED = TO_TIMESTAMP(DELIVERY_TIME, 'DD/MM/YY HH24:MI');



SELECT * FROM SWIGGY LIMIT 10;


----DROPPING A COLUMN

ALTER TABLE SWIGGY
DROP COLUMN ORDER_DATE_FORMATED;



SELECT * FROM SWIGGY;

----o	Extract the year, month, and day from the order_date column in the Swiggy dataset.

SELECT *, EXTRACT(YEAR FROM ORDER_DATE_FORMAT) AS ORDER_YEAR ,
EXTRACT(MONTH FROM ORDER_DATE_FORMAT) AS ORDER_MONTH,
EXTRACT(DAY FROM ORDER_DATE_FORMAT) AS ORDER_DAY FROM SWIGGY;



---- •	Get the current timestamp and compare it with the delivery_time


SELECT CURRENT_TIMESTAMP;


SELECT TIMESTAMPDIFF(HOUR , DELIVERY_TIME_FORMATED, CURRENT_TIMESTAMP) AS TIME FROM SWIGGY;



----•	Calculate the number of days,hours,minutes,etc between the order_date and delivery_time and store it in respective columns


SELECT *, TIMESTAMPDIFF(HOUR, ORDER_DATE_FORMAT, DELIVERY_TIME_FORMATED) AS HOURS_TAKEN_TO_DELIVER, 
TIMESTAMPDIFF(MIN, ORDER_DATE_FORMAT, DELIVERY_TIME_FORMATED )  AS  MINU_TAKEN_TO_DELIVER,
FROM SWIGGY;



----•	Add 45 minutes to the delivery_time and show the updated time.

SELECT *, DATEADD(MINUTE, 45, DELIVERY_TIME_FORMATED) AS UPDATED_TIME FROM SWIGGY;


---- •	Find all orders placed in September of any year.
 
SELECT * FROM SWIGGY WHERE EXTRACT(MONTH FROM ORDER_DATE_FORMAT) = 9;

SELECT COUNT(*) FROM SWIGGY WHERE EXTRACT(MONTH FROM ORDER_DATE_FORMAT) = 9;





----- o	Convert the delivery_time from UTC to a specific time zone (e.g., 'Asia/Kolkata').



SELECT DELIVERY_TIME_FORMATED,
CONVERT_TIMEZONE('UTC', 'Asia/Kolkata', DELIVERY_TIME_FORMATED) AS ZONE FROM SWIGGY;



---- •	Find all orders placed on a weekend (Saturday or Sunday). 

SELECT EXTRACT(DAYOFWEEK FROM ORDER_DATE_FORMAT) as day FROM SWIGGY;



SELECT *, DAYNAME(ORDER_DATE_FORMAT) FROM SWIGGY;

select * from swiggy where 
EXTRACT(DAYOFWEEK FROM ORDER_DATE_FORMAT) = 6 OR EXTRACT(DAYOFWEEK FROM ORDER_DATE_FORMAT) = 7 ;


select COUNT(*) from swiggy where 
EXTRACT(DAYOFWEEK FROM ORDER_DATE_FORMAT) = 6 OR EXTRACT(DAYOFWEEK FROM ORDER_DATE_FORMAT) = 7 ;



----- o	Identify the peak delivery hours by extracting the hour from delivery_time and grouping by hour

SELECT HOUR(DELIVERY_TIME_FORMATED), COUNT(ORDER_ID) AS DELIVERY_IN_THAT_HOUR FROM SWIGGY
GROUP BY HOUR(DELIVERY_TIME_FORMATED)
ORDER BY DELIVERY_IN_THAT_HOUR DESC;



------ o	Identify which day of the week has the most deliveries.

SELECT DAYOFWEEK(DELIVERY_TIME_FORMATED) AS DAY, COUNT(ORDER_ID) AS COUNT_THAT_DAY FROM SWIGGY 
GROUP BY DAY
ORDER BY COUNT_THAT_DAY DESC;




---- •	Find orders where the delivery took more than 1 hour.


SELECT *, TIMESTAMPDIFF(MINUTE, ORDER_DATE_FORMAT , DELIVERY_TIME_FORMATED) AS MINUTES_TAKEN FROM SWIGGY
WHERE MINUTES_TAKEN > 60;





SELECT COUNT(*) FROM SWIGGY
WHERE TIMESTAMPDIFF(MINUTE, ORDER_DATE_FORMAT , DELIVERY_TIME_FORMATED) > 60;


----- o	Find all orders placed between specific date ranges, e.g., between '2023-09-01' and '2023-09-05' and orders placed between 5 PM and 7 PM both for those dates included and without those date too irrespective of dates.


SELECT *
FROM SWIGGY
WHERE ORDER_DATE >= '2023-09-01 00:00:00'  
  AND ORDER_DATE <= '2023-09-05 23:59:59';





---- o	Find orders placed on February 29th (during leap years).

SELECT * FROM SWIGGY WHERE EXTRACT(DAY FROM ORDER_DATE_FORMAT) = 29 AND EXTRACT(MONTH FROM ORDER_DATE_FORMAT) = 02;



--- o	Retrieve the most recent order placed in the last 7 days.
SELECT *
FROM SWIGGY
WHERE ORDER_DATE_FORMAT >= DATEADD(DAY, -7, CURRENT_DATE)  -- Orders in the last 7 days
ORDER BY ORDER_DATE DESC  
LIMIT 1;



---•	Calculate the average delivery time for each city.

SELECT CITY, AVG(HOUR(DELIVERY_TIME_FORMATED)) FROM SWIGGY GROUP BY CITY;


SELECT CITY, COUNT(ORDER_ID) FROM SWIGGY GROUP BY CITY;



--- •	Identify orders that took longer during peak hours (5 PM - 8 PM).
SELECT 
    ORDER_ID, 
    ORDER_DATE, 
    DELIVERY_TIME, 
    TIMESTAMPDIFF(MINUTE, ORDER_DATE_FORMAT, DELIVERY_TIME_FORMATED) AS DURATION_MINUTES
FROM SWIGGY
WHERE EXTRACT(HOUR FROM ORDER_DATE_FORMAT) >= 17  
  AND EXTRACT(HOUR FROM ORDER_DATE_FORMAT) < 20   
ORDER BY DURATION_MINUTES DESC;
